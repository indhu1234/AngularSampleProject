"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Session = void 0;
var Promise = require("bluebird");
var log_1 = require("./log");
var Session = /** @class */ (function () {
    function Session() {
    }
    Session.check = function (domo) {
        return new Promise(function (resolve, reject) {
            var options = {
                url: 'https://' + domo.getInstance() + '/auth/validate',
                method: 'GET',
                resolveWithFullResponse: true
            };
            domo.processRequest(options)
                .then(function (res) {
                try {
                    var isValid = JSON.parse(res.body.toString()).isValid;
                    if (isValid) {
                        resolve(true);
                    }
                    else {
                        reject(false);
                    }
                }
                catch (e) {
                    // couldn't parse as JSON which means the service doesn't exist yet.
                    // TODO: remove this once the /domoweb/auth/validate service has shipped to prod
                    resolve(true);
                }
            })
                .catch(function (err) {
                log_1.log.clientRequestFailed(err.statusCode + ' - ' + err.message, err.failureMessage);
            });
        });
    };
    return Session;
}());
exports.Session = Session;
//# sourceMappingURL=session.js.map